<script setup lang="ts">
import { onMounted, ref, type Ref } from 'vue'
import { useToolbarStore } from '@/stores/useToolbarStore'
import { type ImageItem } from '@/components/common/ImageGalleria.vue'
import ProjectInfoComponent from '@/components/ProjectInfoComponent.vue'

const titlebar = useToolbarStore()

const toolbarComponents = [
  {
    label: 'Github',
    icon: 'pi pi-fw pi-github',
    command: () => window.open('https://github.com/Bussler/OpenGlArap', '_blank'),
  },
  {
    label: 'Paper',
    icon: 'pi pi-fw pi-file',
    command: () => window.open('/pdfs/3DSaMC_ProjectReport.pdf', '_blank'),
  },
]

const images: Ref<ImageItem[]> = ref([
  {
    itemImageSrc: '/images/arap/basemesh.png',
    thumbnailImageSrc: '/images/arap/basemesh.png',
    description: 'Mesh in base position.',
    title: 'Base Position',
  },
  {
    itemImageSrc: '/images/arap/deformed2.png',
    thumbnailImageSrc: '/images/arap/deformed2.png',
    description: 'Mesh in deformed state: Bending',
    title: 'Bending',
  },
  {
    itemImageSrc: '/images/arap/deformed3.png',
    thumbnailImageSrc: '/images/arap/deformed3.png',
    description: 'Mesh in deformed state: Waving',
    title: 'Waving',
  },
])

onMounted(async () => {
  titlebar.setToolbarComponents(toolbarComponents)
})
</script>

<template>
  <Card>
    <template #title>As-Rigid-As-Possible Surface Modeling (ARAP)</template>
    <template #content>
      <ProjectInfoComponent
        :images="images"
        :about="[
          'Implementation of the As-Rigid-As-Possible Surface Modeling (ARAP) algorithm by Sorkine and Alexa (2007) with OpenGL.',
          'ARAP is an algorithm for mesh deformations in a 3-dimensional environment. Depending on a userâ€™s set of control points and predefined constraints, it is possible to render a visually appealing mesh deformation. The mesh itself can be freely rigged in real-time by enabling and disabling vertices as control points and then dragging them to a desired location. The ARAP modelling algorithm is an iterative scheme which preserves local mesh shapes as much as possible and thereby enforces realisitic rigid deformations of the base mesh.',
        ]"
        :goal="[
          'The primary goal of this project was to get additional practice with OpenGL. My interest in the ARAP algorithm was sparked by an uni lecture on the topic of 3D Scanning & Motion Capture',
        ]"
        :background="[
          'Shape deformation of scanned or sculpted 3D objects is used in many visualization tasks and plays an important role in modern computer visualization. However, for a great majority of the deformation tasks from visualization of specific areas of the input model to animation creation, modelers often times want to preserve the general shape of their meshes. When performing a smooth large-scale deformation on an object, like moving the arm of a human, this is intuitively accomplished by preserving the local structure of the object. This means that in this case, the arm is only rotated and translated, but not scaled or sheared. Thus it follows that when local shapes of the object are changed as rigidly as possible, surface details of the mesh tend to be preserved.',
          'The ARAP algorithm implements a shape deformation framework based on the above observation to maximize local rigidity. Starting from polygonal meshes, the algorithm tries to find an ideal deformation by keeping the surface in each local vertex fan as rigid as possible. Local rigidity is measured by aligning each deformed cell with its original shape using e. g. the Procrustes algorithm and thus calculating the local deviation from rigidity when applying a rotation matrix per vertex fan. Consequently, all calculated local cell deviations are summed up in an energy function. When picking and moving a cell of the mesh, an optimization of the energy function can then be used to enforce the movement of all other cells in the mesh to be similar to the deformed part, while maximizing local rigidity.',
        ]"
        :results="null"
        :github="'https://github.com/Bussler/OpenGlArap'"
        :paper="'/pdfs/3DSaMC_ProjectReport.pdf'"
      />
    </template>
  </Card>
</template>

<style scoped>
.image-galleria-container {
  display: flex;
  justify-content: center;
  align-items: center;
}
.panel-margin {
  margin-top: 3ch; /* Adjust the value as needed */
}
</style>
